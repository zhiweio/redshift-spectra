# =============================================================================
# Redshift Spectra - Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment.
#
# This file supports multiple environments:
#   - LOCAL:  Development with LocalStack (default values work out of the box)
#   - DEV:    AWS development account
#   - PROD:   AWS production account
#
# For LocalStack:  cp .env.example .env  (use defaults)
# For AWS:         cp .env.example .env  (then update AWS-specific values)
# =============================================================================

# =============================================================================
# Environment Selection
# =============================================================================
# Environment: local, dev, or prod
ENVIRONMENT=local

# =============================================================================
# AWS / LocalStack Configuration
# =============================================================================
# AWS Region
AWS_DEFAULT_REGION=us-east-1
SPECTRA_AWS_REGION=us-east-1

# LocalStack endpoint (only used when ENVIRONMENT=local)
LOCALSTACK_ENDPOINT=http://localhost:4566

# AWS Credentials
# For LocalStack: use "test" (any non-empty value works)
# For AWS: use your real credentials or leave empty to use IAM roles
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test

# =============================================================================
# Redshift Configuration
# =============================================================================
# Redshift cluster identifier
# LocalStack: use mock value
# AWS: your actual cluster ID
SPECTRA_REDSHIFT_CLUSTER_ID=local-cluster

# Redshift database name
SPECTRA_REDSHIFT_DATABASE=dev

# Secrets Manager ARN for Redshift credentials
# LocalStack: auto-created by Terragrunt
# AWS: your actual secret ARN
SPECTRA_REDSHIFT_SECRET_ARN=arn:aws:secretsmanager:us-east-1:000000000000:secret:redshift-spectra/local/redshift/credentials

# Redshift Serverless workgroup name (optional, leave empty for provisioned cluster)
SPECTRA_REDSHIFT_WORKGROUP_NAME=default

# -----------------------------------------------------------------------------
# Redshift Session Reuse Configuration
# -----------------------------------------------------------------------------
# Session keep-alive duration in seconds (max 24 hours = 86400)
SPECTRA_REDSHIFT_SESSION_KEEP_ALIVE_SECONDS=3600

# Session idle timeout before cleanup (seconds)
SPECTRA_REDSHIFT_SESSION_IDLE_TIMEOUT_SECONDS=300

# =============================================================================
# DynamoDB Configuration
# =============================================================================
# DynamoDB table for job state
SPECTRA_DYNAMODB_TABLE_NAME=redshift-spectra-local-jobs

# DynamoDB table for Redshift sessions
SPECTRA_DYNAMODB_SESSIONS_TABLE_NAME=redshift-spectra-local-sessions

# TTL for job records in days
SPECTRA_DYNAMODB_TTL_DAYS=1

# =============================================================================
# S3 Configuration
# =============================================================================
# S3 bucket for large result exports
SPECTRA_S3_BUCKET_NAME=redshift-spectra-local-data

# S3 prefix for export files
SPECTRA_S3_PREFIX=exports/

# Presigned URL expiration in seconds
SPECTRA_PRESIGNED_URL_EXPIRY=3600

# =============================================================================
# Query Configuration
# =============================================================================
# Row count threshold before switching to S3 export
SPECTRA_RESULT_SIZE_THRESHOLD=10000

# Query timeout in seconds
SPECTRA_QUERY_TIMEOUT_SECONDS=900

# Maximum concurrent queries per tenant
SPECTRA_MAX_CONCURRENT_QUERIES=10

# =============================================================================
# SQL Security Configuration
# =============================================================================
# SQL validation security level: strict, standard, or permissive
# - strict: Only SELECT, limited functions, no subqueries beyond limit
# - standard: SELECT with common functions, subqueries allowed (default)
# - permissive: SELECT with most functions, CTEs and more allowed
SPECTRA_SQL_SECURITY_LEVEL=standard

# Maximum SQL query length in characters
SPECTRA_SQL_MAX_QUERY_LENGTH=100000

# Maximum number of JOINs per query
SPECTRA_SQL_MAX_JOINS=10

# Maximum number of subqueries per query
SPECTRA_SQL_MAX_SUBQUERIES=5

# Allow Common Table Expressions (WITH clause)
SPECTRA_SQL_ALLOW_CTE=true

# Allow UNION statements
SPECTRA_SQL_ALLOW_UNION=false

# =============================================================================
# API Configuration
# =============================================================================
# API version prefix
SPECTRA_API_VERSION=v1

# Allowed CORS origins (comma-separated for multiple origins)
SPECTRA_CORS_ORIGINS=["*"]

# Rate limit per minute per tenant
SPECTRA_RATE_LIMIT_PER_MINUTE=1000

# =============================================================================
# Authentication Configuration
# =============================================================================
# Authentication mode: api_key, jwt, or iam
SPECTRA_AUTH_MODE=api_key

# Secrets Manager ARN for JWT secret (required if auth_mode=jwt)
# LocalStack: auto-created by Terragrunt
# AWS: your actual secret ARN
# SPECTRA_JWT_SECRET_ARN=arn:aws:secretsmanager:us-east-1:000000000000:secret:redshift-spectra/local/jwt

# Expected JWT issuer (optional)
# SPECTRA_JWT_ISSUER=https://auth.example.com

# Expected JWT audience (optional)
# SPECTRA_JWT_AUDIENCE=spectra-api

# =============================================================================
# Logging Configuration
# =============================================================================
# Logging level: DEBUG, INFO, WARNING, ERROR
SPECTRA_LOG_LEVEL=DEBUG

# Enable AWS X-Ray tracing (disabled for LocalStack)
SPECTRA_ENABLE_XRAY=false

# =============================================================================
# LocalStack-Specific Configuration
# =============================================================================
# These settings only apply when ENVIRONMENT=local

# Enable debug mode for more verbose LocalStack logging
DEBUG=0

# Docker network for Lambda execution in LocalStack
LAMBDA_DOCKER_NETWORK=redshift-spectra-network

# Lambda executor (docker or local)
LAMBDA_EXECUTOR=docker

# Persist LocalStack data across restarts (0=disabled, 1=enabled)
LOCALSTACK_PERSISTENCE=0

# Project name (used for resource naming)
PROJECT_NAME=redshift-spectra
